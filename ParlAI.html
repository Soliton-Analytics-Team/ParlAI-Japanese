<!DOCTYPE html>
<html lang="ja">
<head><meta charset="utf-8" />

<title>ParlAI</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<style type="text/css">.prompt { min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default;}@media (max-width: 540px) { .prompt { text-align: left; }}div.inner_cell { min-width: 0; display: flex; flex-direction: column; align-items: stretch; flex: 1;}div.input_area { border: 1px solid #cfcfcf; border-radius: 2px; background: #f7f7f7; line-height: 1.21429em;}div.prompt:empty { padding-top: 0; padding-bottom: 0;}div.unrecognized_cell { padding: 5px 5px 5px 0px; display: flex; flex-direction: row; align-items: stretch;}div.unrecognized_cell .inner_cell { border-radius: 2px; padding: 5px; font-weight: bold; color: red; border: 1px solid #cfcfcf; background: #eaeaea;}div.unrecognized_cell .inner_cell a { color: inherit; text-decoration: none;}div.unrecognized_cell .inner_cell a:hover { color: inherit; text-decoration: none;}@media (max-width: 540px) { div.unrecognized_cell > div.prompt { display: none; }}div.input { page-break-inside: avoid; display: flex; flex-direction: row; align-items: stretch;}@media (max-width: 540px) { div.input { display: flex; flex-direction: column; align-items: stretch; }}div.input_prompt { color: #303F9F; border-top: 1px solid transparent;}div.input_area > div.highlight { margin: 0.4em; border: none; padding: 0px; background-color: transparent;}div.input_area > div.highlight > pre { margin: 0px; border: none; padding: 0px; background-color: transparent;}div.output_wrapper { position: relative; display: flex; flex-direction: column; align-items: stretch; z-index: 1;}div.output_scroll { height: 24em; width: 100%; overflow: auto; border-radius: 2px; -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); display: block;}div.output_collapsed { margin: 0px; padding: 0px; display: flex; flex-direction: column; align-items: stretch;}div.out_prompt_overlay { height: 100%; padding: 0px 0.4em; position: absolute; border-radius: 2px;}div.out_prompt_overlay:hover { -webkit-box-shadow: inset 0 0 1px #000; box-shadow: inset 0 0 1px #000; background: rgba(240, 240, 240, 0.5);}div.output_prompt { color: #D84315;}div.output_area { padding: 0px; page-break-inside: avoid; display: flex; flex-direction: row; align-items: stretch;}div.output_area .MathJax_Display { text-align: left !important;}div.output_area .rendered_html table { margin-left: 0; margin-right: 0;}div.output_area .rendered_html img { margin-left: 0; margin-right: 0;}div.output_area img,div.output_area svg { max-width: 100%; height: auto;}div.output_area img.unconfined,div.output_area svg.unconfined { max-width: none;}div.output_area .mglyph > img { max-width: none;}.output { display: flex; flex-direction: column; align-items: stretch;}@media (max-width: 540px) { div.output_area { display: flex; flex-direction: column; align-items: stretch; }}div.output_area pre { margin: 0; padding: 1px 0 1px 0; border: 0; vertical-align: baseline; color: black; background-color: transparent; border-radius: 0;}div.output_subarea { overflow-x: auto; padding: 0.4em; flex: 1; max-width: calc(100% - 14ex);}div.output_scroll div.output_subarea { overflow-x: visible;}div.output_text { text-align: left; color: #000; line-height: 1.21429em;}div.output_stderr { background: #fdd;}div.output_latex { text-align: left;}div.output_javascript:empty { padding: 0;}.js-error { color: darkred;}input.raw_input { font-family: monospace; font-size: inherit; color: inherit; width: auto; vertical-align: baseline; padding: 0em 0.25em; margin: 0em 0.25em;}input.raw_input:focus { box-shadow: none;}p.p-space { margin-bottom: 10px;}div.output_unrecognized { padding: 5px; font-weight: bold; color: red;}div.output_unrecognized a { color: inherit; text-decoration: none;}div.output_unrecognized a:hover { color: inherit; text-decoration: none;}.rendered_html em { font-style: italic;}.rendered_html strong { font-weight: bold;}.rendered_html u { text-decoration: underline;}.rendered_html :link { text-decoration: underline;}.rendered_html :visited { text-decoration: underline;}.rendered_html h1 { font-size: 185.7%; margin: 1.08em 0 0 0; font-weight: bold; line-height: 1.0;}.rendered_html h2 { font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1.0;}.rendered_html h3 { font-size: 128.6%; margin: 1.55em 0 0 0; font-weight: bold; line-height: 1.0;}.rendered_html h4 { font-size: 100%; margin: 2em 0 0 0; font-weight: bold; line-height: 1.0;}.rendered_html h5 { font-size: 100%; margin: 2em 0 0 0; font-weight: bold; line-height: 1.0; font-style: italic;}.rendered_html h6 { font-size: 100%; margin: 2em 0 0 0; font-weight: bold; line-height: 1.0; font-style: italic;}.rendered_html h1:first-child { margin-top: 0.538em;}.rendered_html h2:first-child { margin-top: 0.636em;}.rendered_html h3:first-child { margin-top: 0.777em;}.rendered_html h4:first-child { margin-top: 1em;}.rendered_html h5:first-child { margin-top: 1em;}.rendered_html h6:first-child { margin-top: 1em;}.rendered_html ul:not(.list-inline),.rendered_html ol:not(.list-inline) { padding-left: 2em;}.rendered_html ul { list-style: disc;}.rendered_html ul ul { list-style: square; margin-top: 0;}.rendered_html ul ul ul { list-style: circle;}.rendered_html ol { list-style: decimal;}.rendered_html ol ol { list-style: upper-alpha; margin-top: 0;}.rendered_html ol ol ol { list-style: lower-alpha;}.rendered_html ol ol ol ol { list-style: lower-roman;}.rendered_html ol ol ol ol ol { list-style: decimal;}.rendered_html * + ul { margin-top: 1em;}.rendered_html * + ol { margin-top: 1em;}.rendered_html hr { color: black; background-color: black;}.rendered_html pre { margin: 1em 2em; padding: 0px; background-color: #fff;}.rendered_html code { background-color: #eff0f1;}.rendered_html p code { padding: 1px 5px;}.rendered_html pre code { background-color: #fff;}.rendered_html pre,.rendered_html code { border: 0; color: #000; font-size: 100%;}.rendered_html blockquote { margin: 1em 2em;}.rendered_html table { margin-left: auto; margin-right: auto; border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed;}.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom;}.rendered_html tr,.rendered_html th,.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none;}.rendered_html th { font-weight: bold;}.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5;}.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2);}.rendered_html * + table { margin-top: 1em;}.rendered_html p { text-align: left;}.rendered_html * + p { margin-top: 1em;}.rendered_html img { display: block; margin-left: auto; margin-right: auto;}.rendered_html * + img { margin-top: 1em;}.rendered_html img,.rendered_html svg { max-width: 100%; height: auto;}.rendered_html img.unconfined,.rendered_html svg.unconfined { max-width: none;}.rendered_html .alert { margin-bottom: initial;}.rendered_html * + .alert { margin-top: 1em;}[dir="rtl"] .rendered_html p { text-align: right;}div.text_cell { display: flex; flex-direction: row; align-items: stretch;}@media (max-width: 540px) { div.text_cell > div.prompt { display: none; }}div.text_cell_render { outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;}a.anchor-link:link { text-decoration: none; padding: 0px 20px; visibility: hidden;}h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link { visibility: visible;}.text_cell.rendered .input_area { display: none;}.text_cell.rendered .rendered_html { overflow-x: auto; overflow-y: hidden;}.text_cell.rendered .rendered_html tr,.text_cell.rendered .rendered_html th,.text_cell.rendered .rendered_html td { max-width: none;}.text_cell.unrendered .text_cell_render { display: none;}.text_cell .dropzone .input_area { border: 2px dashed #bababa; margin: -1px;}.cm-header-1,.cm-header-2,.cm-header-3,.cm-header-4,.cm-header-5,.cm-header-6 { font-weight: bold; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;}.cm-header-1 { font-size: 185.7%;}.cm-header-2 { font-size: 157.1%;}.cm-header-3 { font-size: 128.6%;}.cm-header-4 { font-size: 110%;}.cm-header-5 { font-size: 100%; font-style: italic;}.cm-header-6 { font-size: 100%; font-style: italic;}@media (max-width: 767px) { .notebook_app { padding-left: 0px; padding-right: 0px; }}#ipython-main-app { box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; height: 100%;}div#notebook_panel { margin: 0px; padding: 0px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; height: 100%;}pre,code,kbd,samp { white-space: pre-wrap;}#fonttest { font-family: monospace;}p { margin-bottom: 0;}.end_space { min-height: 100px; transition: height .2s ease;}.notebook_app > #header { -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2); box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);}@media not print { .notebook_app { background-color: #EEE; }}kbd { border-style: solid; border-width: 1px; box-shadow: none; margin: 2px; padding-left: 2px; padding-right: 2px; padding-top: 1px; padding-bottom: 1px;}.jupyter-keybindings { padding: 1px; line-height: 24px; border-bottom: 1px solid gray;}.jupyter-keybindings input { margin: 0; padding: 0; border: none;}.jupyter-keybindings i { padding: 6px;}.well code { background-color: #ffffff; border-color: #ababab; border-width: 1px; border-style: solid; padding: 2px; padding-top: 1px; padding-bottom: 1px;}.highlight .hll { background-color: #ffffcc }.highlight { background: #f8f8f8; }.highlight .c { color: #408080; font-style: italic }.highlight .err { border: 1px solid #FF0000 }.highlight .k { color: #008000; font-weight: bold }.highlight .o { color: #666666 }.highlight .ch { color: #408080; font-style: italic }.highlight .cm { color: #408080; font-style: italic }.highlight .cp { color: #BC7A00 }.highlight .cpf { color: #408080; font-style: italic }.highlight .c1 { color: #408080; font-style: italic }.highlight .cs { color: #408080; font-style: italic }.highlight .gd { color: #A00000 }.highlight .ge { font-style: italic }.highlight .gr { color: #FF0000 }.highlight .gh { color: #000080; font-weight: bold }.highlight .gi { color: #00A000 }.highlight .go { color: #888888 }.highlight .gp { color: #000080; font-weight: bold }.highlight .gs { font-weight: bold }.highlight .gu { color: #800080; font-weight: bold }.highlight .gt { color: #0044DD }.highlight .kc { color: #008000; font-weight: bold }.highlight .kd { color: #008000; font-weight: bold }.highlight .kn { color: #008000; font-weight: bold }.highlight .kp { color: #008000 }.highlight .kr { color: #008000; font-weight: bold }.highlight .kt { color: #B00040 }.highlight .m { color: #666666 }.highlight .s { color: #BA2121 }.highlight .na { color: #7D9029 }.highlight .nb { color: #008000 }.highlight .nc { color: #0000FF; font-weight: bold }.highlight .no { color: #880000 }.highlight .nd { color: #AA22FF }.highlight .ni { color: #999999; font-weight: bold }.highlight .ne { color: #D2413A; font-weight: bold }.highlight .nf { color: #0000FF }.highlight .nl { color: #A0A000 }.highlight .nn { color: #0000FF; font-weight: bold }.highlight .nt { color: #008000; font-weight: bold }.highlight .nv { color: #19177C }.highlight .ow { color: #AA22FF; font-weight: bold }.highlight .w { color: #bbbbbb }.highlight .mb { color: #666666 }.highlight .mf { color: #666666 }.highlight .mh { color: #666666 }.highlight .mi { color: #666666 }.highlight .mo { color: #666666 }.highlight .sa { color: #BA2121 }.highlight .sb { color: #BA2121 }.highlight .sc { color: #BA2121 }.highlight .dl { color: #BA2121 }.highlight .sd { color: #BA2121; font-style: italic }.highlight .s2 { color: #BA2121 }.highlight .se { color: #BB6622; font-weight: bold }.highlight .sh { color: #BA2121 }.highlight .si { color: #BB6688; font-weight: bold }.highlight .sx { color: #008000 }.highlight .sr { color: #BB6688 }.highlight .s1 { color: #BA2121 }.highlight .ss { color: #19177C }.highlight .bp { color: #008000 }.highlight .fm { color: #0000FF }.highlight .vc { color: #19177C }.highlight .vg { color: #19177C }.highlight .vi { color: #19177C }.highlight .vm { color: #19177C }.highlight .il { color: #666666 }</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>
<body>
  <div tabindex="-1" class="border-box-sizing">
    <div class="container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://ai.facebook.com/blog/state-of-the-art-open-source-chatbot" target="_top">こんな記事</a>をみました。すごく自然な対話ができるということでColabで試しました。以下の手順で実行するだけで再現できるようにしてあります。</p>
<p>さっそく<a href="https://github.com/facebookresearch/ParlAI" target="_top">github</a>の手順に従って、インストールします。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>git clone https://github.com/facebookresearch/ParlAI.git ~/ParlAI
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">cd</span> ~/ParlAI <span class="p">;</span> python setup.py develop
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>チャットボットを走らせる前に以下のコマンドを実行する必要があります。これをせずに走らせるとエラーとなって、このコマンドを先に実行せよとのメッセージが出ます。ここではあらかじめ実行しておきましょう。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install <span class="s1">&#39;git+https://github.com/rsennrich/subword-nmt.git#egg=subword-nmt&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>下記のコマンドで一番小さいサイズのチャットボットが走ります。初回起動時は90Mバイトのモデルをダウンロードするので、入力状態になるまで数十秒の時間がかかります。「Enter Your Message:」のプロンプトが出たら、英語でメッセージを入力してみましょう。対話を終了するには[EXIT]を入力します。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /root/ParlAI
<span class="o">!</span>python parlai/scripts/safe_interactive.py -t blended_skill_talk -mf zoo:blender/blender_90M/model
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>以下に実行例を示します。</p>
<p><pre>
[context]: your persona: i have bowled a 300 game twice in my life.
your persona: i have been held hostage in a store robbery situation.
Enter Your Message: Hello
[TransformerGenerator]: hi ! how are you ? i ' m a yoga instructor . what do you like to do ?
Enter Your Message: I like to play tennis.
[TransformerGenerator]: that ' s cool . i like watching sports . do you have any hobbies besides tennis ?
Enter Your Message: No.
[TransformerGenerator]: tennis is a great sport . i love watching it . what ' s your favorite sport to play ?
Enter Your Message: Tennis!
[TransformerGenerator]: i ' ve never played tennis , but i ' d love to try . what else do you do for fun ?
Enter Your Message: Nothing.
[TransformerGenerator]: have you ever tried yoga ? it ' s a great way to relax and get to know yourself .
Enter Your Message: No, I have not.
[TransformerGenerator]: you should give it a try . it can be a lot of work , but it is very relaxing .
Enter Your Message: Good.
[TransformerGenerator]: what is your favorite type of yoga ? mine is hatha yoga , which i like a lot .
Enter Your Message: I don't know.
[TransformerGenerator]: well , you should try it . it will help you get used to the different types of yoga .
Enter Your Message: [EXIT]
CHAT DONE.
Your partner was playing the following persona:
partner's persona: watching sports is fun.
partner's persona: i go to yoga.
EPOCH DONE
</pre>
意外と簡単に動きました。ちぐはぐなところもありますが、一番小さいモデルなので、仕方ありません。ペルソナがボーリング好きに設定されているようなので、ボーリングの話をするべきだったのかもしれません。反応速度は悪くありませんが、CPUのみで動かす場合は、このモデルが限界のようです。</p>
<p>中規模のモデルで動かしてみましょう。初回起動時は3Gバイトのモデルをダウンロードするので、入力状態になるまで十分程度の時間がかかります。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python parlai/scripts/safe_interactive.py -t blended_skill_talk -mf zoo:blender/blender_3B/model
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><pre>
[context]: your persona: i'm an avid quilter.
your persona: my grand children mean the world to me.
Enter Your Message: Hello
[TransformerGenerator]: How are you doing this evening? I'm just relaxing in my car. It's a 20 year old car.
Enter Your Message: I'm fine. Is it a classic car?
[TransformerGenerator]: Yes, it's a 1965 Chevrolet Camaro. What do you drive?
Enter Your Message: I drive a BMW.
[TransformerGenerator]: That's nice. Do you have any hobbies that you like to do in your spare time?
Enter Your Message: My hobby is tennis.
[TransformerGenerator]: Tennis is fun. I used to play a lot when I was younger. What is your favorite color?
Enter Your Message: I love red!
[TransformerGenerator]: That's a great color. I like red too. What else do you enjoy doing in your free time?
Enter Your Message: I enjoy reading books.
[TransformerGenerator]: Reading is a great way to pass the time. What are some of your favorite authors?
Enter Your Message: I love Osamu Dazai.
[TransformerGenerator]: I've never heard of him, but I'll have to check him out. What genre of books does he write?
Enter Your Message: [EXIT]
CHAT DONE.
Your partner was playing the following persona:
partner's persona: my car is over 20 years old.
partner's persona: i did not finish college.
EPOCH DONE
</pre>
スムーズな会話ができてます。ColabでGPUをオンにすれば、反応速度もまずまずで実用に足ります。CPUのみの場合は何分も応答が返って来ないので、GPUは必須です。よく見ると、応答がちゃんとキャピタライズされています。最小モデルではそうなっていないので、そのあたりの品質も向上するようです。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>最大モデルはblender_9Bなのですが、これは起動すらしません。少なくとも32GBのV100 GPUが二つ必要とのことなので、Colabでは動きません。</p>
<p>ところで、上記のコマンドsafe_interactive.pyのsafeとはなんでしょう。実は暴言をチェックして警告する機能が付いているのです。これを外すにはinteractive.pyを用います。また以降のsafe_local_humanもlocal_humanに置き換えれば暴言チェックなしになります。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>さて、これだけだと、ただのご紹介になってしまうので、これを<a href="https://github.com/uliontse/translators">translators</a>を使って日本語化してみましょう。入力と出力にGoogle翻訳を挟みます。translatorsのインストールと使い方は以下になります。ただし、利用は学生および個人に制限されていますので、商用にはご使用にならないよう、お願いします。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install translators
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">translators</span> <span class="k">as</span> <span class="nn">ts</span>
<span class="kn">from</span> <span class="nn">loguru</span> <span class="k">import</span> <span class="n">logger</span>
<span class="n">logger</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="s1">&#39;translators&#39;</span><span class="p">)</span>　<span class="c1"># ログ出力を抑制します</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">google</span><span class="p">(</span><span class="s2">&quot;How are you doing this evening? I&#39;m just relaxing in my car. It&#39;s a 20 year old car.&quot;</span><span class="p">,</span> <span class="n">to_language</span><span class="o">=</span><span class="s1">&#39;ja&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>今夜はどうですか？車でくつろぐだけです。 20歳の車です。
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Google翻訳、いまいちですね。実はこれ、DeepL翻訳だと「今日の夜はどうですか？私は車でのんびりしています。20年前の車です。」と翻訳されてはるかに良いのですが、残念ながらtranslatorsのDeepL翻訳だとすぐにtoo many requestsのエラーが出てしまいます。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>デバッガーでステップ実行して調べたところ、ユーザーからの入力は以下の部分でした。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat -n parlai/agents/safe_local_human/safe_local_human.py <span class="p">|</span> tail +97 <span class="p">|</span> head -5
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>    97	    def get_reply(self):
    98	        reply_text = input(colorize(&#39;Enter Your Message:&#39;, &#39;field&#39;) + &#39; &#39;)
    99	        reply_text = reply_text.replace(&#39;\\n&#39;, &#39;\n&#39;)
   100	
   101	        return reply_text
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>これを以下のコマンドで書き換えます。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mv parlai/agents/safe_local_human/safe_local_human.py .
<span class="o">!</span>sed -e <span class="s2">&quot;12i import translators as ts&quot;</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/return reply_text$/reply_text = ts.google(reply_text, to_language=&#39;en&#39;); print(reply_text); return reply_text/&quot;</span> \
 <span class="o">./</span><span class="n">safe_local_human</span><span class="o">.</span><span class="n">py</span> <span class="o">&gt;</span> <span class="n">parlai</span><span class="o">/</span><span class="n">agents</span><span class="o">/</span><span class="n">safe_local_human</span><span class="o">/</span><span class="n">safe_local_human</span><span class="o">.</span><span class="n">py</span>
<span class="o">!</span>cat -n parlai/agents/safe_local_human/safe_local_human.py <span class="p">|</span> tail +98 <span class="p">|</span> head -5
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>    98	    def get_reply(self):
    99	        reply_text = input(colorize(&#39;Enter Your Message:&#39;, &#39;field&#39;) + &#39; &#39;)
   100	        reply_text = reply_text.replace(&#39;\\n&#39;, &#39;\n&#39;)
   101	
   102	        reply_text = ts.google(reply_text, to_language=&#39;en&#39;); print(reply_text); return reply_text
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>チャットボットから出力は以下の部分です。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat -n parlai/utils/misc.py <span class="p">|</span> tail +793 <span class="p">|</span> head -2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>   793	        if msg.get(&#39;text&#39;, &#39;&#39;):
   794	            text = clip_text(msg[&#39;text&#39;], max_len)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>これを以下のコマンドで書き換えます</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mv parlai/utils/misc.py .
<span class="o">!</span>sed -e <span class="s2">&quot;10i import translators as ts&quot;</span> <span class="err">\</span>
  <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/], max_len)$/], max_len); print(text); text = ts.google(text, to_language=&#39;ja&#39;)/&quot;</span> \
  <span class="o">./</span><span class="n">misc</span><span class="o">.</span><span class="n">py</span> <span class="o">&gt;</span> <span class="n">parlai</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">misc</span><span class="o">.</span><span class="n">py</span>
<span class="o">!</span>cat -n parlai/utils/misc.py <span class="p">|</span> tail +794 <span class="p">|</span> head -2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>   794	        if msg.get(&#39;text&#39;, &#39;&#39;):
   795	            text = clip_text(msg[&#39;text&#39;], max_len); print(text); text = ts.google(text, to_language=&#39;ja&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>それでは実行してみましょう。翻訳前後のテキストも表示するようにしてあります。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[0]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python parlai/scripts/safe_interactive.py -t blended_skill_talk -mf zoo:blender/blender_3B/model
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><pre>
your persona: my family is very supportive of my skiing.
your persona: i am a competitive ski racer.</p>
<p>あなたのペルソナ：私は競争力のあるスキーレーサーです。
Enter Your Message: こんにちは
Hello
What do you like to do for fun? I like to play with my dogs and my cats.</p>
<p>Enter Your Message: 私は猫が好きです。
I like cats.
I like them too. Do you have any kids? We have a 14 year old and a 12 year old.
<a href="話してよかったです良い一日を過ごしてください！バイバイ！バイバイ！">TransformerGenerator</a>: 私もそれが好きです。お子さんはいらっしゃいますか？ 14歳と12歳です。
Enter Your Message: ２４歳の娘がいます。
I have a 24 year old daughter.
That's a big age difference. How do you feel about her being so much older than you?</p>
<p>Enter Your Message: 私の方が年上ですよ。
I am older
Oh, sorry. I misread that. How old are you, if you don't mind me asking?</p>
<p>Enter Your Message: 秘密です。
Is a secret.
Oh, okay. Well, I hope you have a great day. I have to go now.</p>
<p>Enter Your Message: さよなら
Goodbye
That was nice talking to you. Have a good day! Bye!  Bye bye!</p>
<p>Enter Your Message: [EXIT]
[EXIT]
CHAT DONE.
Your partner was playing the following persona:
partner's persona: our kids are 14 and 12 years old.
partner's persona: we also have three dogs and two cats.
EPOCH DONE</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ところどころ翻訳がダメなところがありますが、会話自体はまあまあ成り立ってます。</p>
<p>いかがでしたでしょう。意外と簡単に日本語化できましたね。</p>

</div>
</div>
</div>
    </div>
  </div>
</body>

 


</html>
